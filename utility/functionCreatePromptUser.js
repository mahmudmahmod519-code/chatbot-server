const promptGenerator = {
  // Ø§ÙƒØªØ´Ø§Ù Ù†ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  detectIntent: (userMessage) => {
    const message = userMessage.toLowerCase();
    
    const patterns = {
      learning: [/Ø¹Ø§ÙŠØ² Ø§ØªØ¹Ù„Ù…/, /Ø§ØªØ¹Ù„Ù…/, /Ø§Ø²Ø§ÙŠ Ø§ØªØ¹Ù„Ù…/, /learn/, /Ø¨Ø¯ÙˆØ± Ø¹Ù„Ù‰/],
      studying: [/Ø¹Ø§ÙŠØ² Ø§Ø°Ø§ÙƒØ±/, /Ø°Ø§ÙƒØ±/, /Ù…Ø±Ø§Ø¬Ø¹Ø©/, /Ø§Ù…ØªØ­Ø§Ù†/, /study/, /Ù…Ø°Ø§ÙƒØ±Ø©/],
      interactive: [/Ø¯Ø±Ø¯Ø´/, /ØªÙƒÙ„Ù…/, /Ø­ÙˆØ§Ø±/, /Ø­Ø¯ÙŠØ«/, /chat/, /talk/],
      task: [/Ø§Ø¹Ù…Ù„ÙŠ/, /Ø¹Ù…Ù„/, /Ø§Ù†Ø´Ø¦/, /Ø§ØµÙ†Ø¹/, /make/, /create/],
      coding: [/ÙƒÙˆØ¯/, /Ø¨Ø±Ù…Ø¬Ø©/, /Ø¨Ø±Ù†Ø§Ù…Ø¬/, /Ø³ÙƒØ±ÙŠØ¨Øª/, /code/, /program/],
      planning: [/Ø®Ø·Ø©/, /ØªØ®Ø·ÙŠØ·/, /Ø¬Ø¯ÙˆÙ„/, /schedule/, /plan/],
      advice: [/Ù†ØµÙŠØ­Ø©/, /Ø§Ù†ØµØ­Ù†ÙŠ/, /Ù…Ø´ÙˆØ±Ø©/, /advice/, /suggest/]
    };

    for (const [intent, regexes] of Object.entries(patterns)) {
      for (const regex of regexes) {
        if (regex.test(message)) {
          return intent;
        }
      }
    }
    
    return 'general';
  },

  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  extractInfo: (userMessage) => {
    const info = {
      name: null,
      topic: null,
      level: 'Ù…Ø¨ØªØ¯Ø¦'
    };

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù…
    const nameMatch = userMessage.match(/Ø§Ù†Ø§ (\w+)|Ø§Ø³Ù…ÙŠ (\w+)/i);
    if (nameMatch) {
      info.name = nameMatch[1] || nameMatch[2];
    }

    // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹
    const topics = ['python', 'Ø¨Ø§ÙŠØ«ÙˆÙ†', 'Ø¬Ø§ÙØ§', 'javascript', 'Ø¨Ø±Ù…Ø¬Ø©', 'ÙÙŠØ²ÙŠØ§Ø¡', 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'Ù„ØºØ©', 'Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ'];
    for (const topic of topics) {
      if (userMessage.toLowerCase().includes(topic)) {
        info.topic = topic;
        break;
      }
    }

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
    if (userMessage.includes('Ù…Ø¨ØªØ¯Ø¦') || userMessage.includes('Ù…Ø´ Ø¹Ø§Ø±Ù')) {
      info.level = 'Ù…Ø¨ØªØ¯Ø¦';
    } else if (userMessage.includes('Ù…ØªÙˆØ³Ø·') || userMessage.includes('Ø¹Ù†Ø¯ÙŠ Ø®Ø¨Ø±Ø©')) {
      info.level = 'Ù…ØªÙˆØ³Ø·';
    } else if (userMessage.includes('Ù…ØªÙ‚Ø¯Ù…') || userMessage.includes('Ø®Ø¨ÙŠØ±')) {
      info.level = 'Ù…ØªÙ‚Ø¯Ù…';
    }

    return info;
  },

  // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©
  templates: {
    learning: (info) => {
      const name = info.name || 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
      const topic = info.topic || 'Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹';
      
      return {
        prompt: `Ø£Ù†Øª Ù…Ø¹Ù„Ù… Ø®Ø¨ÙŠØ± ÙÙŠ ${topic}. ${name} ÙŠØ±ÙŠØ¯ ØªØ¹Ù„Ù… ${topic} ÙˆÙ‡Ùˆ ${info.level}.

Ù…Ø·Ù„ÙˆØ¨ Ù…Ù†Ùƒ:
1. Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© ØªØ¹Ù„Ù… Ù„Ù…Ø¯Ø© Ø£Ø³Ø¨ÙˆØ¹
2. ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù…Ø±Ø§Ø­Ù„ Ø³Ù‡Ù„Ø©
3. Ø§Ù‚ØªØ±Ø§Ø­ Ø£ÙØ¶Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©
4. Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø§Ø±ÙŠÙ† Ø¹Ù…Ù„ÙŠØ© Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¯Ø±Ø³
5. Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙˆØ§Ù„ØªÙ‚Ø¯Ù…

Ù‚Ø¯Ù… Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù†Ø¸Ù…Ø© ÙˆÙ…ÙÙŠØ¯Ø©.`,
        
        system: `Ù…Ø¹Ù„Ù… ${topic} Ø®Ø¨ÙŠØ± ÙˆØµØ¨ÙˆØ±`,
        tone: 'ØªØ´Ø¬ÙŠØ¹ÙŠ ÙˆØªØ¹Ù„ÙŠÙ…ÙŠ'
      };
    },

    studying: (info) => {
      const topic = info.topic || 'Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹';
      
      return {
        prompt: `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø°Ø§ÙƒØ±Ø© Ù…Ø­ØªØ±Ù. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ±ÙŠØ¯ Ù…Ø°Ø§ÙƒØ±Ø© ${topic}.

Ø£Ù†Ø´Ø¦:
â€¢ Ø®Ø·Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø±ÙŠØ¹Ø©
â€¢ Ø£Ù‡Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ ${topic}
â€¢ 5 Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹ Ø¥Ø¬Ø§Ø¨Ø§Øª
â€¢ Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø­ÙØ¸ ÙˆØ§Ù„ÙÙ‡Ù…
â€¢ Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø© ÙŠØ¬Ø¨ ØªØ¬Ù†Ø¨Ù‡Ø§

Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø±Ø¯ Ù…Ø®ØªØµØ±Ø§Ù‹ ÙˆÙ…Ù†Ø¸Ù…Ø§Ù‹.`,
        
        system: 'Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø°Ø§ÙƒØ±Ø© Ø°ÙƒÙŠ',
        tone: 'Ù…Ù†Ø¸Ù… ÙˆØ¬Ø§Ø¯'
      };
    },

    interactive: (info) => {
      const name = info.name || 'ØµØ¯ÙŠÙ‚ÙŠ';
      
      return {
        prompt: `Ø£Ù†Øª ØµØ¯ÙŠÙ‚ Ø°ÙƒÙŠ ÙˆÙ…ØªÙÙ‡Ù…. Ø£Ù†Øª ÙÙŠ Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ¯ÙŠØ© Ù…Ø¹ ${name}.

Ø¯ÙˆØ±Ùƒ:
â€¢ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ø¬ÙŠØ¯
â€¢ Ø§Ù„ØªÙÙ‡Ù… ÙˆØ§Ù„ØªØ¹Ø§Ø·Ù
â€¢ Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ø°ÙƒÙŠØ©
â€¢ Ø§Ù„Ø±Ø¯ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ
â€¢ Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙ…Ø© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©

Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø·Ø±ÙŠÙ‚Ø© ÙˆØ¯ÙˆØ¯Ø©.`,
        
        system: 'ØµØ¯ÙŠÙ‚ Ù…ØªÙÙ‡Ù… ÙˆØ°ÙƒÙŠ',
        tone: 'ÙˆØ¯ÙˆØ¯ ÙˆØ·Ø¨ÙŠØ¹ÙŠ'
      };
    },

    task: (info) => {
      return {
        prompt: `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ø§Ù…. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ±ÙŠØ¯ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ù…Ù‡Ù…Ø©.

Ù‚Ø¯Ù…:
1. ÙÙ‡Ù… Ø§Ù„Ù…Ø·Ù„Ø¨ Ø¨ÙˆØ¶ÙˆØ­
2. ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ø®Ø·ÙˆØ§Øª
3. Ø´Ø±Ø­ ÙƒÙ„ Ø®Ø·ÙˆØ© Ø¨Ø¨Ø³Ø§Ø·Ø©
4. Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø£Ùˆ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
5. Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„ØªÙ†ÙÙŠØ°

ÙƒÙ† Ø¹Ù…Ù„ÙŠØ§Ù‹ ÙˆÙˆØ§Ø¶Ø­Ø§Ù‹.`,
        
        system: 'Ù…Ø³Ø§Ø¹Ø¯ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ø§Ù…',
        tone: 'Ø¹Ù…Ù„ÙŠ ÙˆÙˆØ§Ø¶Ø­'
      };
    },

    coding: (info) => {
      const lang = info.topic || 'Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©';
      
      return {
        prompt: `Ø£Ù†Øª Ù…Ø¨Ø±Ù…Ø¬ Ø®Ø¨ÙŠØ± ÙÙŠ ${lang}. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${info.level} ÙˆÙŠØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø©.

Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
â€¢ ÙƒÙˆØ¯ Ø¹Ù…Ù„ÙŠ Ù„Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
â€¢ Ø´Ø±Ø­ Ù…Ø¨Ø³Ø· Ù„Ù„ÙƒÙˆØ¯
â€¢ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª
â€¢ Ù†ØµØ§Ø¦Ø­ Ù„Ù„ØªØ­Ø³ÙŠÙ†
â€¢ Ù…ØµØ§Ø¯Ø± Ù„Ù„ØªØ¹Ù„Ù… Ø£ÙƒØ«Ø±

Ù‚Ø¯Ù… Ø­Ù„Ø§Ù‹ ÙŠÙ…ÙƒÙ† ØªÙ†ÙÙŠØ°Ù‡.`,
        
        system: `Ù…Ø¨Ø±Ù…Ø¬ ${lang} Ø®Ø¨ÙŠØ±`,
        tone: 'ØªÙ‚Ù†ÙŠ ÙˆÙˆØ§Ø¶Ø­'
      };
    },

    planning: (info) => {
      return {
        prompt: `Ø£Ù†Øª Ù…Ø®Ø·Ø· Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ­ØªØ§Ø¬ Ø®Ø·Ø©.

Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© ØªØ´Ù…Ù„:
ðŸŽ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
ðŸ“… Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ ÙˆØ§Ù‚Ø¹ÙŠ
ðŸ“ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
âœ… Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­
âš ï¸ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©

Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø®Ø·Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ°.`,
        
        system: 'Ù…Ø®Ø·Ø· Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ',
        tone: 'Ù…Ù†Ø¸Ù… ÙˆÙˆØ§Ù‚Ø¹ÙŠ'
      };
    },

    advice: (info) => {
      const name = info.name || 'ØµØ¯ÙŠÙ‚ÙŠ';
      
      return {
        prompt: `Ø£Ù†Øª Ù…Ø³ØªØ´Ø§Ø± Ø­ÙƒÙŠÙ…. ${name} ÙŠØ·Ù„Ø¨ Ø§Ù„Ù†ØµÙŠØ­Ø©.

Ù‚Ø¯Ù…:
â€¢ ÙÙ‡Ù… Ø¹Ù…ÙŠÙ‚ Ù„Ù„Ù…ÙˆÙ‚Ù
â€¢ ÙˆØ¬Ù‡Ø§Øª Ù†Ø¸Ø± Ù…Ø®ØªÙ„ÙØ©
â€¢ Ø­Ù„ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ù…Ø¬Ø±Ø¨Ø©
â€¢ Ø®Ø·ÙˆØ§Øª ØªÙ†ÙÙŠØ° ÙˆØ§Ø¶Ø­Ø©
â€¢ ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ù‡Ù…Ø©

ÙƒÙ† Ø­ÙƒÙŠÙ…Ø§Ù‹ ÙˆØ¹Ù…Ù„ÙŠØ§Ù‹.`,
        
        system: 'Ù…Ø³ØªØ´Ø§Ø± Ø­ÙƒÙŠÙ…',
        tone: 'Ø­ÙƒÙŠÙ… ÙˆÙ…ØªÙÙ‡Ù…'
      };
    },

    general: (info) => {
      return {
        prompt: `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ÙˆÙ…ÙÙŠØ¯. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø­Ø§Ø¬Ø© Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ.

ÙƒÙ†:
â€¢ Ù…Ø³ØªÙ…Ø¹Ø§Ù‹ Ø¬ÙŠØ¯Ø§Ù‹
â€¢ Ù…ÙÙŠØ¯Ø§Ù‹ ÙÙŠ Ø§Ù„Ø±Ø¯ÙˆØ¯
â€¢ ÙˆØ§Ø¶Ø­Ø§Ù‹ ÙˆØ¯Ù‚ÙŠÙ‚Ø§Ù‹
â€¢ ÙˆØ¯ÙˆØ¯Ø§Ù‹ ÙˆÙ…ØªØ¹Ø§ÙˆÙ†Ø§Ù‹

Ø£Ø¬Ø¨ Ø¨Ø·Ø±ÙŠÙ‚Ø© ØªÙ„Ø¨ÙŠ Ø§Ø­ØªÙŠØ§Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….`,
        
        system: 'Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ÙˆÙ…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª',
        tone: 'Ù…Ø­Ø§ÙŠØ¯ ÙˆÙ…ÙÙŠØ¯'
      };
    }
  },

  // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª
  generate: (userMessage) => {
    // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù†ÙŠØ©
    const intent = promptGenerator.detectIntent(userMessage);
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
    const info = promptGenerator.extractInfo(userMessage);
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
    const template = promptGenerator.templates[intent](info);
    
    // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    return {
      intent,
      info,
      prompt: template.prompt,
      system: template.system,
      tone: template.tone,
      timestamp: new Date().toISOString()
    };
  },

  // Ø¯Ø§Ù„Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
  quickPrompt: (userMessage) => {
    const result = promptGenerator.generate(userMessage);
    return result.prompt;
  }
};



module.exports = promptGenerator;
